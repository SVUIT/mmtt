<div class="dm-container" role="group" aria-label="Chuyển chủ đề">
    <input type="checkbox" class="checkbox js-toggle-dark-mode" id="theme-switch"
      role="switch" aria-checked="false" aria-label="Chuyển chế độ tối">
    <label for="theme-switch" class="checkbox-label">
        <i class="fa-solid fa-sun" aria-hidden="true"></i>
        <i class="fa-solid fa-moon" aria-hidden="true"></i>
      <span class="ball" aria-hidden="true"></span>
      <span class="visually-hidden">Bật/tắt chế độ tối</span>
    </label>
  </div>
  <script>
    const toggleDarkMode = document.querySelector('.js-toggle-dark-mode');
    const container = document.querySelector('.dm-container');
    const setAriaChecked = (el, isChecked) => {
      el.setAttribute('aria-checked', String(isChecked));
    };
    const applyContainerClass = (isDark) => {
      if (!container) return;
      container.classList.toggle('dark', isDark);
    };

    // Initialize from saved theme or current JTD theme / system preference
    const saved = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const currentTheme = saved || (typeof jtd !== 'undefined' && jtd.getTheme && jtd.getTheme()) || (systemPrefersDark ? 'dark' : 'light');

    const isDarkInit = currentTheme === 'dark';
    toggleDarkMode.checked = isDarkInit;
    setAriaChecked(toggleDarkMode, isDarkInit);
    applyContainerClass(isDarkInit);

    jtd.addEvent(toggleDarkMode, 'click', function(){
      const isDarkNow = !(jtd.getTheme() === 'dark'); // will switch to opposite
      if (isDarkNow) {
        jtd.setTheme('dark');
        window.localStorage.setItem('theme', 'dark');
        setAriaChecked(toggleDarkMode, true);
      } else {
        jtd.setTheme('light');
        window.localStorage.setItem('theme', 'light');
        setAriaChecked(toggleDarkMode, false);
      }
      applyContainerClass(isDarkNow);
    });
    </script>